<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>PayPal Complete</title></head><body>
  <h1>Completing payment…</h1>
  <div id="status">Please wait</div>
  <script>
    (async ()=>{
      const params = new URLSearchParams(location.search);
      const token = params.get('token');
      const local = params.get('local');
      const statusEl = document.getElementById('status');
      if(!token || !local){ statusEl.textContent = 'Missing parameters.'; return }
      try{
        const res = await fetch('/api/capture', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ paypalOrderId: token, localOrderId: local }) });
        const j = await res.json();
        if(res.ok){
          statusEl.innerHTML = '<strong>Payment completed.</strong> Thank you — your order has been recorded.';
          setTimeout(()=> location.href = '/merch/index.html', 3000);
        }else{
          statusEl.innerHTML = 'Capture failed: ' + (j.error||'unknown');
        }
      }catch(e){ statusEl.textContent = 'Network error'; console.error(e); }
    })();
  </script>
</body></html>
